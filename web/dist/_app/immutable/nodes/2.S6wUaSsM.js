import{i as H,b as xe,s as lr,a as or,_ as Le}from"../chunks/uyRO2bnN.js";import{b as Me,d as ir,f as T,a as g,c as le}from"../chunks/AeTPHnLl.js";import{i as fr}from"../chunks/C62xKhxH.js";import{o as dr}from"../chunks/uX088rO7.js";import{h as Y,I as ke,H as vr,o as e,ax as cr,K as ur,M as pr,O as He,P as Se,Q as ye,f as re,a5 as We,av as _r,ag as ze,c as gr,e as Te,s as br,at as Ae,ay as mr,a8 as Ve,X as P,az as hr,aA as xr,aB as yr,b as $e,aC as X,r as Ye,p as qe,aD as we,a6 as Be,as as wr,d as Er,y as K,$ as kr,aE as Sr,aw as Tr,aq as Nr,Z as ve,w as Ar,aF as oe,aG as Ir,z as Rr,Y as E,aH as Or,aI as Cr,aJ as Pr,A as h,C as q,B as x,k as S,x as ie}from"../chunks/DkV7x_kp.js";import{e as Ee,s as fe}from"../chunks/B2tf5Pcc.js";import{s as Fe}from"../chunks/Ddpj_Nb7.js";import{s as Dr}from"../chunks/Da-hfTAI.js";function Lr(r,f){return f}function Mr(r,f,o){for(var p=[],k=f.length,a,d=f.length,l=0;l<k;l++){let i=f[l];qe(i,()=>{if(a){if(a.pending.delete(i),a.done.add(i),a.pending.size===0){var w=r.outrogroups;Ne(Ae(a.done)),w.delete(a),w.size===0&&(r.outrogroups=null)}}else d-=1},!1)}if(d===0){var n=p.length===0&&o!==null;if(n){var v=o,u=v.parentNode;wr(u),u.append(v),r.items.clear()}Ne(f,!n)}else a={pending:new Set(f),done:new Set},(r.outrogroups??=new Set).add(a)}function Ne(r,f=!0){for(var o=0;o<r.length;o++)Er(r[o],f)}var Je;function Hr(r,f,o,p,k,a=null){var d=r,l=new Map;Y&&ke();var n=null,v=cr(()=>{var _=o();return mr(_)?_:_==null?[]:Ae(_)}),u,i=!0;function w(){s.fallback=n,zr(s,u,d,f,p),n!==null&&(u.length===0?(n.f&X)===0?Ye(n):(n.f^=X,de(n,null,d)):qe(n,()=>{n=null}))}var C=vr(()=>{u=e(v);var _=u.length;let z=!1;if(Y){var V=ur(d)===pr;V!==(_===0)&&(d=He(),Se(d),ye(!1),z=!0)}for(var b=new Set,$=gr,D=br(),N=0;N<_;N+=1){Y&&re.nodeType===We&&re.data===_r&&(d=re,z=!0,ye(!1));var F=u[N],J=p(F,N),m=i?null:l.get(J);m?(m.v&&ze(m.v,F),m.i&&ze(m.i,N),D&&$.skipped_effects.delete(m.e)):(m=Vr(l,i?d:Je??=$e(),F,J,N,k,f,o),i||(m.e.f|=X),l.set(J,m)),b.add(J)}if(_===0&&a&&!n&&(i?n=Te(()=>a(d)):(n=Te(()=>a(Je??=$e())),n.f|=X)),Y&&_>0&&Se(He()),!i)if(D){for(const[ce,ae]of l)b.has(ce)||$.skipped_effects.add(ae.e);$.oncommit(w),$.ondiscard(()=>{})}else w();z&&ye(!0),e(v)}),s={effect:C,items:l,outrogroups:null,fallback:n};i=!1,Y&&(d=re)}function zr(r,f,o,p,k){var a=f.length,d=r.items,l=r.effect.first,n,v=null,u=[],i=[],w,C,s,_;for(_=0;_<a;_+=1){if(w=f[_],C=k(w,_),s=d.get(C).e,r.outrogroups!==null)for(const m of r.outrogroups)m.pending.delete(s),m.done.delete(s);if((s.f&X)!==0)if(s.f^=X,s===l)de(s,null,o);else{var z=v?v.next:l;s===r.effect.last&&(r.effect.last=s.prev),s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),B(r,v,s),B(r,s,z),de(s,z,o),v=s,u=[],i=[],l=v.next;continue}if((s.f&we)!==0&&Ye(s),s!==l){if(n!==void 0&&n.has(s)){if(u.length<i.length){var V=i[0],b;v=V.prev;var $=u[0],D=u[u.length-1];for(b=0;b<u.length;b+=1)de(u[b],V,o);for(b=0;b<i.length;b+=1)n.delete(i[b]);B(r,$.prev,D.next),B(r,v,$),B(r,D,V),l=V,v=D,_-=1,u=[],i=[]}else n.delete(s),de(s,l,o),B(r,s.prev,s.next),B(r,s,v===null?r.effect.first:v.next),B(r,v,s),v=s;continue}for(u=[],i=[];l!==null&&l!==s;)(n??=new Set).add(l),i.push(l),l=l.next;if(l===null)continue}(s.f&X)===0&&u.push(s),v=s,l=s.next}if(r.outrogroups!==null){for(const m of r.outrogroups)m.pending.size===0&&(Ne(Ae(m.done)),r.outrogroups?.delete(m));r.outrogroups.size===0&&(r.outrogroups=null)}if(l!==null||n!==void 0){var N=[];if(n!==void 0)for(s of n)(s.f&we)===0&&N.push(s);for(;l!==null;)(l.f&we)===0&&l!==r.fallback&&N.push(l),l=l.next;var F=N.length;if(F>0){var J=null;Mr(r,N,J)}}}function Vr(r,f,o,p,k,a,d,l){var n=(d&xr)!==0?(d&yr)===0?P(o,!1,!1):Ve(o):null,v=(d&hr)!==0?Ve(k):null;return{v:n,i:v,e:Te(()=>(a(f,n??o,v??k,l),()=>{r.delete(p)}))}}function de(r,f,o){if(r.nodes)for(var p=r.nodes.start,k=r.nodes.end,a=f&&(f.f&X)===0?f.nodes.start:o;p!==null;){var d=Be(p);if(a.before(p),p===k)return;p=d}}function B(r,f,o){f===null?r.effect.first=o:f.next=o,o===null?r.effect.last=f:o.prev=f}function $r(r,f,o=!1,p=!1,k=!1){var a=r,d="";K(()=>{var l=kr;if(d===(d=f()??"")){Y&&ke();return}if(l.nodes!==null&&(Sr(l.nodes.start,l.nodes.end),l.nodes=null),d!==""){if(Y){re.data;for(var n=ke(),v=n;n!==null&&(n.nodeType!==We||n.data!=="");)v=n,n=Be(n);if(n===null)throw Tr(),Nr;Me(re,v),a=Se(n);return}var u=d+"";o?u=`<svg>${u}</svg>`:p&&(u=`<math>${u}</math>`);var i=ir(u);if((o||p)&&(i=ve(i)),Me(ve(i),i.lastChild),o||p)for(;ve(i);)a.before(ve(i));else a.before(i)}})}function Fr(r,f,o){var p=r==null?"":""+r;return p===""?null:p}function Ue(r,f,o,p,k,a){var d=r.__className;if(Y||d!==o||d===void 0){var l=Fr(o);(!Y||l!==r.getAttribute("class"))&&(l==null?r.removeAttribute("class"):r.className=l),r.__className=o}return a}const Jr=()=>{const r=Dr;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Ur={subscribe(r){return Jr().page.subscribe(r)}};var Wr=T('<div class="rounded border border-emerald-400/40 bg-emerald-400/10 px-2 py-0.5 text-xs text-emerald-200">Token</div>'),Yr=T('<div class="flex-none border-b border-red-500/50 bg-red-500/10 px-4 py-2 text-sm text-red-100"> </div>'),qr=T('<div class="h-full flex items-center justify-center"><div class="rounded-xl border border-dashed border-slate-700 px-8 py-12 text-center text-slate-400"><div class="text-lg mb-1">No plots yet</div> <div class="text-sm">Send from Python to see them here</div></div></div>'),Br=T('<img class="max-h-full max-w-full rounded-lg border border-slate-800 bg-slate-950/40 object-contain" alt="plot"/>'),Kr=T('<div class="w-full h-full rounded-lg border border-slate-800 bg-slate-950/40 p-2"><div class="w-full h-full"></div></div>'),Xr=T('<div class="w-full h-full rounded-lg border border-slate-800 bg-slate-950/40 p-2"><div class="w-full h-full"></div></div>'),Gr=T('<div class="prose prose-invert max-h-full overflow-auto rounded-lg border border-slate-800 bg-slate-950/40 p-4"><!></div>'),Qr=T('<pre class="max-h-full overflow-auto rounded-lg border border-slate-800 bg-slate-950/40 p-4 text-xs text-slate-200"> </pre>'),Zr=T('<div class="h-full flex items-center justify-center"><!></div>'),jr=T('<div class="flex-none text-sm text-slate-500 py-4 px-2">Waiting for plots...</div>'),ea=T('<img alt="" class="w-full h-full object-contain"/>'),ra=T('<span class="text-xs text-slate-500 uppercase"> </span>'),aa=T('<button><div class="w-20 h-14 rounded bg-slate-900 flex items-center justify-center overflow-hidden"><!></div> <span class="text-[10px] text-slate-400"> </span></button>'),ta=T('<div class="h-screen flex flex-col bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900 text-slate-50"><header class="flex-none flex items-center justify-between gap-3 border-b border-slate-800/70 bg-slate-900/60 px-4 py-2 backdrop-blur"><div class="text-sm font-semibold uppercase tracking-[0.15em] text-slate-300">RileyViewer</div> <div class="flex items-center gap-2"><div class="flex items-center gap-1.5 rounded-full border border-slate-800 bg-slate-900 px-2.5 py-0.5 text-xs"><span></span> <span class="capitalize text-slate-300"> </span></div> <!> <button class="rounded border border-slate-700 bg-slate-800 px-2 py-0.5 text-xs font-medium text-slate-200 hover:border-slate-500 hover:bg-slate-700">Reconnect</button></div></header> <!> <main class="flex-1 min-h-0 p-4"><!></main> <footer class="flex-none border-t border-slate-800/70 bg-slate-900/60 backdrop-blur"><div class="flex gap-2 p-3 overflow-x-auto" style="scrollbar-width: thin; scrollbar-color: #334155 transparent;"><!></div></footer></div>');function ca(r,f){Ar(f,!1);const o=()=>or(Ur,"$page",p),[p,k]=lr(),a=P(),d=P(),l=P();let n=null,v=P("idle"),u=P(null),i=P([]),w=P(null),C=P(null),s=P(null),_=null,z=null,V=null,b=P(null);dr(()=>(D(),()=>n?.close()));function $(t,c){const A=t.protocol==="https:"?"wss:":"ws:",U=c?`?token=${encodeURIComponent(c)}`:"";return`${A}//${t.host}/ws${U}`}function D(){E(v,"connecting"),E(u,null),n?.close(),n=new WebSocket(e(l)),n.addEventListener("open",()=>{E(v,"open")}),n.addEventListener("message",async t=>{try{const c=JSON.parse(t.data);E(i,[...e(i),c]),E(w,c.id),await Or(),e(b)&&Cr(b,e(b).scrollLeft=e(b).scrollWidth)}catch(c){console.error("failed to parse plot message",c)}}),n.addEventListener("close",()=>{E(v,"closed")}),n.addEventListener("error",t=>{E(v,"error"),E(u,"Unable to connect (check token?)"),console.error("ws error",t)})}function N(t){return new Date(Number(t)/1e6).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function F(t){return t.type==="Png"?`data:image/png;base64,${t.data}`:t.type==="Svg"?`data:image/svg+xml;base64,${btoa(t.data)}`:null}function J(t){return F(t.content)}async function m(t){if(!e(C))return;const c=JSON.parse(t.data),A=z??(await Le(async()=>{const{default:U}=await import("../chunks/DH74f3Lu.js").then(y=>y.p);return{default:U}},[],import.meta.url)).default;z=A,await A.react(e(C),c.data??c,c.layout??{})}async function ce(t){if(!e(s))return;_?.();const c=JSON.parse(t.data),A=V??(await Le(async()=>{const{default:y}=await import("../chunks/CNnNVxXy.js");return{default:y}},[],import.meta.url)).default;V=A;const U=await A(e(s),c,{actions:!1,renderer:"canvas"});_=()=>U.view.finalize()}oe(()=>(e(i),e(w)),()=>{E(a,e(i).find(t=>t.id===e(w))??e(i).at(-1))}),oe(()=>o(),()=>{E(d,o().url.searchParams.get("token"))}),oe(()=>(o(),e(d)),()=>{E(l,$(o().url,e(d)))}),oe(()=>(e(a),e(C)),()=>{e(a)?.content.type==="Plotly"&&e(C)&&m(e(a).content)}),oe(()=>(e(a),e(s)),()=>{e(a)?.content.type==="Vega"&&e(s)&&ce(e(a).content)}),Ir(),fr();var ae=ta();Ee("keydown",Pr,t=>{t.key==="r"&&t.metaKey&&(t.preventDefault(),D())});var ue=h(ae),Ie=q(h(ue),2),pe=h(Ie),Re=h(pe),Oe=q(Re,2),Ke=h(Oe,!0);x(Oe),x(pe);var Ce=q(pe,2);{var Xe=t=>{var c=Wr();g(t,c)};H(Ce,t=>{e(d)&&t(Xe)})}var Ge=q(Ce,2);x(Ie),x(ue);var Pe=q(ue,2);{var Qe=t=>{var c=Yr(),A=h(c,!0);x(c),K(()=>fe(A,e(u))),g(t,c)};H(Pe,t=>{e(u)&&t(Qe)})}var _e=q(Pe,2),Ze=h(_e);{var je=t=>{var c=qr();g(t,c)},er=t=>{var c=Zr(),A=h(c);{var U=I=>{var W=le(),te=ie(W);{var se=G=>{var R=Br();K(L=>Fe(R,"src",L),[()=>(e(a),S(()=>F(e(a).content)??""))]),g(G,R)};H(te,G=>{e(a),S(()=>F(e(a).content))&&G(se)})}g(I,W)},y=I=>{var W=le(),te=ie(W);{var se=R=>{var L=Kr(),O=h(L);xe(O,M=>E(C,M),()=>e(C)),x(L),g(R,L)},G=R=>{var L=le(),O=ie(L);{var M=Z=>{var j=Xr(),be=h(j);xe(be,me=>E(s,me),()=>e(s)),x(j),g(Z,j)},ne=Z=>{var j=le(),be=ie(j);{var me=ee=>{var Q=Gr(),he=h(Q);$r(he,()=>(e(a),S(()=>e(a).content.data))),x(Q),g(ee,Q)},sr=ee=>{var Q=Qr(),he=h(Q);x(Q),K(nr=>fe(he,`${nr??""}
					`),[()=>(e(a),S(()=>JSON.stringify(e(a).content,null,2)))]),g(ee,Q)};H(be,ee=>{e(a),S(()=>e(a).content.type==="Html")?ee(me):ee(sr,!1)},!0)}g(Z,j)};H(O,Z=>{e(a),S(()=>e(a).content.type==="Vega")?Z(M):Z(ne,!1)},!0)}g(R,L)};H(te,R=>{e(a),S(()=>e(a).content.type==="Plotly")?R(se):R(G,!1)},!0)}g(I,W)};H(A,I=>{e(a),S(()=>e(a).content.type==="Png"||e(a).content.type==="Svg")?I(U):I(y,!1)})}x(c),g(t,c)};H(Ze,t=>{e(a)?t(er,!1):t(je)})}x(_e);var De=q(_e,2),ge=h(De),rr=h(ge);{var ar=t=>{var c=jr();g(t,c)},tr=t=>{var c=le(),A=ie(c);Hr(A,1,()=>e(i),Lr,(U,y)=>{var I=aa(),W=h(I),te=h(W);{var se=O=>{var M=ea();K(ne=>Fe(M,"src",ne),[()=>(e(y),S(()=>J(e(y))))]),g(O,M)},G=O=>{var M=ra(),ne=h(M,!0);x(M),K(()=>fe(ne,(e(y),S(()=>e(y).content.type)))),g(O,M)};H(te,O=>{e(y),S(()=>J(e(y)))?O(se):O(G,!1)})}x(W);var R=q(W,2),L=h(R,!0);x(R),x(I),K(O=>{Ue(I,1,(e(w),e(y),S(()=>`flex-none flex flex-col items-center gap-1 rounded-lg border p-1.5 transition hover:border-slate-500 ${e(w)===e(y).id?"border-emerald-400/60 bg-emerald-400/10":"border-slate-700 bg-slate-800/60"}`))),fe(L,O)},[()=>(e(y),S(()=>N(e(y).timestamp)))]),Ee("click",I,()=>E(w,e(y).id)),g(U,I)}),g(t,c)};H(rr,t=>{e(i),S(()=>e(i).length===0)?t(ar):t(tr,!1)})}x(ge),xe(ge,t=>E(b,t),()=>e(b)),x(De),x(ae),K(()=>{Ue(Re,1,`h-1.5 w-1.5 rounded-full ${e(v)==="open"?"bg-emerald-400":e(v)==="connecting"?"bg-amber-400":"bg-slate-500"}`),fe(Ke,e(v))}),Ee("click",Ge,D),g(r,ae),Rr(),k()}export{ca as component};
