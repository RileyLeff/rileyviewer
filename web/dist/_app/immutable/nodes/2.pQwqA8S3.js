import{_ as de,i as W,b as ye,s as ct,a as ut}from"../chunks/DKLOg1j1.js";import{b as Me,d as vt,f as R,a as y,c as se}from"../chunks/B_ZvtCf9.js";import{o as pt}from"../chunks/BNWQdMKa.js";import{h as Y,t as Ie,q as gt,G as t,ax as _t,v as mt,H as ht,w as ze,x as ke,y as we,f as re,U as Ye,av as bt,ag as He,c as yt,e as Pe,s as wt,at as Ce,ay as xt,a8 as Ue,F as Et,az as Tt,aA as It,aB as kt,b as Fe,aC as X,r as Be,p as Ge,aD as xe,V as Qe,as as Pt,d as St,X as Q,M as Ct,aE as Nt,aw as Rt,aq as At,J as fe,a2 as Ot,aF as Ee,j as Je,I as w,a6 as B,a3 as Dt,aG as z,aH as Lt,aI as Te,aJ as Vt,a4 as T,a5 as I,W as le}from"../chunks/jS2qlvTZ.js";import{d as Mt,e as zt,s as oe}from"../chunks/CzKkU7hF.js";import{s as We}from"../chunks/Cq4UER6L.js";import{s as Ht}from"../chunks/CDJUuWen.js";function Ut(e,d){return d}function Ft(e,d,o){for(var _=[],C=d.length,c,i=d.length,r=0;r<C;r++){let f=d[r];Ge(f,()=>{if(c){if(c.pending.delete(f),c.done.add(f),c.pending.size===0){var V=e.outrogroups;Se(Ce(c.done)),V.delete(c),V.size===0&&(e.outrogroups=null)}}else i-=1},!1)}if(i===0){var l=_.length===0&&o!==null;if(l){var v=o,u=v.parentNode;Pt(u),u.append(v),e.items.clear()}Se(d,!l)}else c={pending:new Set(d),done:new Set},(e.outrogroups??=new Set).add(c)}function Se(e,d=!0){for(var o=0;o<e.length;o++)St(e[o],d)}var qe;function Jt(e,d,o,_,C,c=null){var i=e,r=new Map;Y&&Ie();var l=null,v=_t(()=>{var m=o();return xt(m)?m:m==null?[]:Ce(m)}),u,f=!0;function V(){n.fallback=l,Wt(n,u,i,d,_),l!==null&&(u.length===0?(l.f&X)===0?Be(l):(l.f^=X,ie(l,null,i)):Ge(l,()=>{l=null}))}var q=gt(()=>{u=t(v);var m=u.length;let D=!1;if(Y){var H=mt(i)===ht;H!==(m===0)&&(i=ze(),ke(i),we(!1),D=!0)}for(var k=new Set,g=yt,$=wt(),A=0;A<m;A+=1){Y&&re.nodeType===Ye&&re.data===bt&&(i=re,D=!0,we(!1));var K=u[A],U=_(K,A),x=f?null:r.get(U);x?(x.v&&He(x.v,K),x.i&&He(x.i,A),$&&g.skipped_effects.delete(x.e)):(x=qt(r,f?i:qe??=Fe(),K,U,A,C,d,o),f||(x.e.f|=X),r.set(U,x)),k.add(U)}if(m===0&&c&&!l&&(f?l=Pe(()=>c(i)):(l=Pe(()=>c(qe??=Fe())),l.f|=X)),Y&&m>0&&ke(ze()),!f)if($){for(const[Z,ce]of r)k.has(Z)||g.skipped_effects.add(ce.e);g.oncommit(V),g.ondiscard(()=>{})}else V();D&&we(!0),t(v)}),n={effect:q,items:r,outrogroups:null,fallback:l};f=!1,Y&&(i=re)}function Wt(e,d,o,_,C){var c=d.length,i=e.items,r=e.effect.first,l,v=null,u=[],f=[],V,q,n,m;for(m=0;m<c;m+=1){if(V=d[m],q=C(V,m),n=i.get(q).e,e.outrogroups!==null)for(const x of e.outrogroups)x.pending.delete(n),x.done.delete(n);if((n.f&X)!==0)if(n.f^=X,n===r)ie(n,null,o);else{var D=v?v.next:r;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),G(e,v,n),G(e,n,D),ie(n,D,o),v=n,u=[],f=[],r=v.next;continue}if((n.f&xe)!==0&&Be(n),n!==r){if(l!==void 0&&l.has(n)){if(u.length<f.length){var H=f[0],k;v=H.prev;var g=u[0],$=u[u.length-1];for(k=0;k<u.length;k+=1)ie(u[k],H,o);for(k=0;k<f.length;k+=1)l.delete(f[k]);G(e,g.prev,$.next),G(e,v,g),G(e,$,H),r=H,v=$,m-=1,u=[],f=[]}else l.delete(n),ie(n,r,o),G(e,n.prev,n.next),G(e,n,v===null?e.effect.first:v.next),G(e,v,n),v=n;continue}for(u=[],f=[];r!==null&&r!==n;)(l??=new Set).add(r),f.push(r),r=r.next;if(r===null)continue}(n.f&X)===0&&u.push(n),v=n,r=n.next}if(e.outrogroups!==null){for(const x of e.outrogroups)x.pending.size===0&&(Se(Ce(x.done)),e.outrogroups?.delete(x));e.outrogroups.size===0&&(e.outrogroups=null)}if(r!==null||l!==void 0){var A=[];if(l!==void 0)for(n of l)(n.f&xe)===0&&A.push(n);for(;r!==null;)(r.f&xe)===0&&r!==e.fallback&&A.push(r),r=r.next;var K=A.length;if(K>0){var U=null;Ft(e,A,U)}}}function qt(e,d,o,_,C,c,i,r){var l=(i&It)!==0?(i&kt)===0?Et(o,!1,!1):Ue(o):null,v=(i&Tt)!==0?Ue(C):null;return{v:l,i:v,e:Pe(()=>(c(d,l??o,v??C,r),()=>{e.delete(_)}))}}function ie(e,d,o){if(e.nodes)for(var _=e.nodes.start,C=e.nodes.end,c=d&&(d.f&X)===0?d.nodes.start:o;_!==null;){var i=Qe(_);if(c.before(_),_===C)return;_=i}}function G(e,d,o){d===null?e.effect.first=o:d.next=o,o===null?e.effect.last=d:o.prev=d}function $t(e,d,o=!1,_=!1,C=!1){var c=e,i="";Q(()=>{var r=Ct;if(i===(i=d()??"")){Y&&Ie();return}if(r.nodes!==null&&(Nt(r.nodes.start,r.nodes.end),r.nodes=null),i!==""){if(Y){re.data;for(var l=Ie(),v=l;l!==null&&(l.nodeType!==Ye||l.data!=="");)v=l,l=Qe(l);if(l===null)throw Rt(),At;Me(re,v),c=ke(l);return}var u=i+"";o?u=`<svg>${u}</svg>`:_&&(u=`<math>${u}</math>`);var f=vt(u);if((o||_)&&(f=fe(f)),Me(fe(f),f.lastChild),o||_)for(;fe(f);)c.before(fe(f));else c.before(f)}})}function Yt(e,d,o){var _=e==null?"":""+e;return _===""?null:_}function $e(e,d,o,_,C,c){var i=e.__className;if(Y||i!==o||i===void 0){var r=Yt(o);(!Y||r!==e.getAttribute("class"))&&(r==null?e.removeAttribute("class"):e.className=r),e.__className=o}return c}const Bt=()=>{const e=Ht;return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},updated:e.updated}},Gt={subscribe(e){return Bt().page.subscribe(e)}};var Qt=R('<div class="rounded border border-emerald-400/40 bg-emerald-400/10 px-2 py-0.5 text-xs text-emerald-200">Token</div>'),Xt=R('<div class="flex-none border-b border-red-500/50 bg-red-500/10 px-4 py-2 text-sm text-red-100"> </div>'),Kt=R('<div class="h-full flex items-center justify-center"><div class="rounded-xl border border-dashed border-slate-700 px-8 py-12 text-center text-slate-400"><div class="text-lg mb-1">No plots yet</div> <div class="text-sm">Send from Python to see them here</div></div></div>'),jt=R('<img class="max-h-full max-w-full rounded-lg border border-slate-800 bg-slate-950/40 object-contain" alt="plot"/>'),Zt=R('<div class="w-full h-full rounded-lg border border-slate-800 bg-slate-950/40 p-2"><div class="w-full h-full"></div></div>'),ea=R('<div class="w-full h-full rounded-lg border border-slate-800 bg-slate-950/40 p-2"><div class="w-full h-full"></div></div>'),ta=R('<div class="prose prose-invert max-h-full overflow-auto rounded-lg border border-slate-800 bg-slate-950/40 p-4"><!></div>'),aa=R('<pre class="max-h-full overflow-auto rounded-lg border border-slate-800 bg-slate-950/40 p-4 text-xs text-slate-200"> </pre>'),ra=R('<div class="h-full flex items-center justify-center"><!></div>'),na=R('<div class="flex-none text-sm text-slate-500 py-4 px-2">Waiting for plots...</div>'),sa=R('<img alt="" class="w-full h-full object-contain"/>'),la=R('<span class="text-xs text-slate-500 uppercase"> </span>'),oa=R('<button><div class="w-20 h-14 rounded bg-slate-900 flex items-center justify-center overflow-hidden"><!></div> <span class="text-[10px] text-slate-400"> </span></button>'),ia=R('<div class="h-screen flex flex-col bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900 text-slate-50"><header class="flex-none flex items-center justify-between gap-3 border-b border-slate-800/70 bg-slate-900/60 px-4 py-2 backdrop-blur"><div class="text-sm font-semibold uppercase tracking-[0.15em] text-slate-300">RileyViewer</div> <div class="flex items-center gap-2"><div class="flex items-center gap-1.5 rounded-full border border-slate-800 bg-slate-900 px-2.5 py-0.5 text-xs"><span></span> <span class="capitalize text-slate-300"> </span></div> <!> <button class="rounded border border-slate-700 bg-slate-800 px-2 py-0.5 text-xs font-medium text-slate-200 hover:border-slate-500 hover:bg-slate-700">Reconnect</button></div></header> <!> <main class="flex-1 min-h-0 p-4"><!></main> <footer class="flex-none border-t border-slate-800/70 bg-slate-900/60 backdrop-blur"><div class="flex gap-2 p-3 overflow-x-auto" style="scrollbar-width: thin; scrollbar-color: #334155 transparent;"><!></div></footer></div>');function _a(e,d){Ot(d,!0);const o=()=>ut(Gt,"$page",_),[_,C]=ct();let c=z(null),i=z("idle"),r=z(null),l=Ee([]),v=z(null),u=z(null),f=z(null),V=z(null),q=z(null),n=z(null),m=z(null),D=Ee({}),H=Ee([]),k=z(!1),g=Te(()=>l.find(a=>a.id===t(v))??l.at(-1)),$=Te(()=>o().url.searchParams.get("token")),A=Te(()=>K(o().url,t($)));Je(()=>{t(g)?.content.type==="Plotly"&&t(u)&&Ke(t(g).id,t(g).content)}),Je(()=>{t(g)?.content.type==="Vega"&&t(f)&&je(t(g).id,t(g).content)}),pt(()=>(U(),()=>t(c)?.close()));function K(a,s){const h=a.protocol==="https:"?"wss:":"ws:",p=s?`?token=${encodeURIComponent(s)}`:"";return`${h}//${a.host}/ws${p}`}function U(){w(i,"connecting"),w(r,null),t(c)?.close(),w(c,new WebSocket(t(A)),!0),t(c).addEventListener("open",()=>{w(i,"open")}),t(c).addEventListener("message",async a=>{try{const s=JSON.parse(a.data);l.push(s),w(v,s.id,!0),await Lt(),t(m)&&(t(m).scrollLeft=t(m).scrollWidth),(s.content.type==="Plotly"||s.content.type==="Vega")&&ce(s)}catch(s){console.error("failed to parse plot message",s)}}),t(c).addEventListener("close",()=>{w(i,"closed")}),t(c).addEventListener("error",a=>{w(i,"error"),w(r,"Unable to connect (check token?)"),console.error("ws error",a)})}function x(a){return new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Z(a){return a.type==="Png"?`data:image/png;base64,${a.data}`:a.type==="Svg"?`data:image/svg+xml;base64,${btoa(a.data)}`:null}function ce(a){H.push(a),Ne()}async function Ne(){if(t(k)||H.length===0)return;w(k,!0);const a=H.shift();a&&(await new Promise(s=>setTimeout(s,0)),await Xe(a)),w(k,!1),Ne()}async function Xe(a){if(!D[a.id]){if(a.content.type==="Plotly")try{const s=t(q)??(await de(async()=>{const{default:O}=await import("../chunks/DH74f3Lu.js").then(N=>N.p);return{default:O}},[],import.meta.url)).default;w(q,s,!0);const h=JSON.parse(a.content.data),p=document.createElement("div");p.style.position="absolute",p.style.left="-9999px",p.style.width="800px",p.style.height="560px",document.body.appendChild(p);const E={...h.layout??{},width:800,height:560};await s.newPlot(p,h.data??h,E,{staticPlot:!0});const b=await s.toImage(p,{format:"png",width:800,height:560});s.purge(p),document.body.removeChild(p);const P=new Image;P.src=b,await new Promise(O=>P.onload=O);const S=document.createElement("canvas");S.width=160,S.height=112;const M=S.getContext("2d");M&&(M.drawImage(P,0,0,160,112),D[a.id]=S.toDataURL("image/png"))}catch(s){console.warn("Failed to generate Plotly thumbnail:",s)}else if(a.content.type==="Vega")try{const s=t(n)??(await de(async()=>{const{default:O}=await import("../chunks/CNnNVxXy.js");return{default:O}},[],import.meta.url)).default;w(n,s,!0);const h=JSON.parse(a.content.data),p=document.createElement("div");p.style.position="absolute",p.style.left="-9999px",p.style.width="800px",p.style.height="560px",document.body.appendChild(p);const E={...h,width:h.width??760,height:h.height??520},b=await s(p,E,{actions:!1,renderer:"canvas"}),P=await b.view.toCanvas(1);b.view.finalize(),document.body.removeChild(p);const S=document.createElement("canvas");S.width=160,S.height=112;const M=S.getContext("2d");M&&(M.drawImage(P,0,0,160,112),D[a.id]=S.toDataURL("image/png"))}catch(s){console.warn("Failed to generate Vega thumbnail:",s)}}}async function Ke(a,s){if(!t(u))return;const h=JSON.parse(s.data),p=t(q)??(await de(async()=>{const{default:E}=await import("../chunks/DH74f3Lu.js").then(b=>b.p);return{default:E}},[],import.meta.url)).default;w(q,p,!0),await p.react(t(u),h.data??h,h.layout??{})}async function je(a,s){if(!t(f))return;t(V)?.();const h=JSON.parse(s.data),p=t(n)??(await de(async()=>{const{default:b}=await import("../chunks/CNnNVxXy.js");return{default:b}},[],import.meta.url)).default;w(n,p,!0);const E=await p(t(f),h,{actions:!1,renderer:"canvas"});w(V,()=>E.view.finalize())}var ue=ia();zt("keydown",Vt,a=>{a.key==="r"&&a.metaKey&&(a.preventDefault(),U())});var ve=T(ue),Re=B(T(ve),2),pe=T(Re),Ae=T(pe),Oe=B(Ae,2),Ze=T(Oe,!0);I(Oe),I(pe);var De=B(pe,2);{var et=a=>{var s=Qt();y(a,s)};W(De,a=>{t($)&&a(et)})}var tt=B(De,2);tt.__click=U,I(Re),I(ve);var Le=B(ve,2);{var at=a=>{var s=Xt(),h=T(s,!0);I(s),Q(()=>oe(h,t(r))),y(a,s)};W(Le,a=>{t(r)&&a(at)})}var ge=B(Le,2),rt=T(ge);{var nt=a=>{var s=Kt();y(a,s)},st=a=>{var s=ra(),h=T(s);{var p=b=>{var P=se(),S=le(P);{var M=O=>{var N=jt();Q(F=>We(N,"src",F),[()=>Z(t(g).content)??""]),y(O,N)};W(S,O=>{Z(t(g).content)&&O(M)})}y(b,P)},E=b=>{var P=se(),S=le(P);{var M=N=>{var F=Zt(),L=T(F);ye(L,J=>w(u,J),()=>t(u)),I(F),y(N,F)},O=N=>{var F=se(),L=le(F);{var J=ee=>{var te=ea(),me=T(te);ye(me,he=>w(f,he),()=>t(f)),I(te),y(ee,te)},ne=ee=>{var te=se(),me=le(te);{var he=ae=>{var j=ta(),be=T(j);$t(be,()=>t(g).content.data),I(j),y(ae,j)},dt=ae=>{var j=aa(),be=T(j);I(j),Q(ft=>oe(be,`${ft??""}
					`),[()=>JSON.stringify(t(g).content,null,2)]),y(ae,j)};W(me,ae=>{t(g).content.type==="Html"?ae(he):ae(dt,!1)},!0)}y(ee,te)};W(L,ee=>{t(g).content.type==="Vega"?ee(J):ee(ne,!1)},!0)}y(N,F)};W(S,N=>{t(g).content.type==="Plotly"?N(M):N(O,!1)},!0)}y(b,P)};W(h,b=>{t(g).content.type==="Png"||t(g).content.type==="Svg"?b(p):b(E,!1)})}I(s),y(a,s)};W(rt,a=>{t(g)?a(st,!1):a(nt)})}I(ge);var Ve=B(ge,2),_e=T(Ve),lt=T(_e);{var ot=a=>{var s=na();y(a,s)},it=a=>{var s=se(),h=le(s);Jt(h,17,()=>l,Ut,(p,E)=>{var b=oa();b.__click=()=>w(v,t(E).id,!0);var P=T(b),S=T(P);{var M=L=>{var J=sa();Q(ne=>We(J,"src",ne),[()=>D[t(E).id]??Z(t(E).content)]),y(L,J)},O=L=>{var J=la(),ne=T(J,!0);I(J),Q(()=>oe(ne,t(E).content.type)),y(L,J)};W(S,L=>{D[t(E).id]||Z(t(E).content)?L(M):L(O,!1)})}I(P);var N=B(P,2),F=T(N,!0);I(N),I(b),Q(L=>{$e(b,1,`flex-none flex flex-col items-center gap-1 rounded-lg border p-1.5 transition hover:border-slate-500 ${t(v)===t(E).id?"border-emerald-400/60 bg-emerald-400/10":"border-slate-700 bg-slate-800/60"}`),oe(F,L)},[()=>x(t(E).timestamp)]),y(p,b)}),y(a,s)};W(lt,a=>{l.length===0?a(ot):a(it,!1)})}I(_e),ye(_e,a=>w(m,a),()=>t(m)),I(Ve),I(ue),Q(()=>{$e(Ae,1,`h-1.5 w-1.5 rounded-full ${t(i)==="open"?"bg-emerald-400":t(i)==="connecting"?"bg-amber-400":"bg-slate-500"}`),oe(Ze,t(i))}),y(e,ue),Dt(),C()}Mt(["click"]);export{_a as component};
